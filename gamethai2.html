<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡∏±‡∏á‡∏î‡πâ‡∏á</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jspdf-thai-font@1.0.6/dist/th-sarabun-new-normal.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" href="https://raw.githubusercontent.com/infobwd/wdconnect/main/%E0%B8%AA%E0%B8%9E%E0%B8%90%203D%20%E0%B8%82%E0%B8%AD%E0%B8%9A.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-thai@1.0.4/dist/jspdf.umd.thai.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-thai-font@1.0.6/dist/th-sarabun-new-normal.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfmake-thai-font@1.0.3/dist/pdfmake-thai-font.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <style>
        body {
            font-family: 'Google Sans', sans-serif;
            padding-top: 80px;
            padding-bottom: 50px;
        }
        .navbar {
            background-color: #0066cc !important;
        }
        .navbar-brand, .navbar-button {
            color: white !important;
        }
        .navbar-button:hover {
            color: #f8f9fa !important;
        }
        .navbar-brand img {
            height: 30px;
            margin-right: 10px;
        }
        #setup, #game {
            max-width: 600px;
            margin: 0 auto;
            margin-top: 10px;
        }
        #game {
            display: none;
        }
        .team-setup {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .team-input {
            width: 45%;
        }
        .team-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .team-display {
            display: flex;
            align-items: center;
            padding: 5px;
            border-radius: 5px;
            position: relative;
        }
        .active-team {
            background-color: #ffffd0; /* Light pastel yellow */
        }
        .crown-icon {
            position: absolute;
            top: -10px;
            left: 12%;
            transform: translateX(-50%) rotate(-10deg);
            font-size: 24px;
            color: #ffd700; /* Dark yellow */
            display: none;
        }
        .leading-team .crown-icon {
            display: block;
        }
        .team-icon {
            font-size: 32px;
            margin-right: 10px;
        }
        .score-buttons {
            display: flex;
            align-items: center;
        }
        .score-button {
            width: 30px;
            height: 30px;
            font-size: 20px;
            padding: 0;
            margin: 0 2px;
        }
        .score-button.add { background-color: #34a853; }
        .score-button.subtract { background-color: #ea4335; }
        #puzzle {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 5px;
            margin-bottom: 20px;
        }
        .piece {
            aspect-ratio: 1 / 1;
            border: 2px solid #ccc;
            font-size: 54px;
            background-size: 300% 300%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            position: relative;
        }
        .piece::before {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: var(--piece-bg-color);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: -1;
        }
        .piece[data-index="0"]::before { background-color: #FFB3BA; }
        .piece[data-index="1"]::before { background-color: #FFDFBA; }
        .piece[data-index="2"]::before { background-color: #FFFFBA; }
        .piece[data-index="3"]::before { background-color: #BAFFC9; }
        .piece[data-index="4"]::before { background-color: #BAE1FF; }
        .piece[data-index="5"]::before { background-color: #FFB3FF; }
        .piece[data-index="6"]::before { background-color: #B3E5FF; }
        .piece[data-index="7"]::before { background-color: #D4BAFF; }
        .piece[data-index="8"]::before { background-color: #FFCBA4; }
        .revealed {
            background-color: transparent;
        }
        #solution-modal, #countdown-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 15vw;
            text-align: center;
            z-index: 1000;
        }
        #solution-modal .red {
            color: red;
        }
        @media (max-width: 600px) {
            .piece { font-size: 54px; }
            .title-spacing {
                margin-top: 25px;
                margin-bottom: 2px;
            }
            .team-info {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
            .team-display {
                flex-direction: row;
                align-items: center;
                width: 45%;
            }
            .team-icon {
                font-size: 34px;
            }
            #word-set-title {
                display: block;
                text-align: center;
                margin-top: 2px;
                margin-bottom: 2px;
            }

            #word-set-title br {
                display: block;
            }
        }
        footer {
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }
        .support-button, .contact-button {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.875rem;
        }
        .support-button:hover, .contact-button:hover {
            background-color: #004d99;
        }
        .support-button i, .contact-button i {
            margin-right: 5px;
        }
        .button-group {
            display: flex;
            gap: 5px;
            justify-content: flex-end;
        }
   
        .navbar .navbar-button {
            margin-left: 5px;
        }
        #showNavbarTab {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #0066cc;
            color: white;
            padding: 10px;
            cursor: pointer;
            z-index: 1001;
        }
        #showNavbarTab i {
            font-size: 24px;
        }
        #promptpay-number {
            cursor: pointer;
            text-decoration: underline;
            color: blue;
        }
        #qr-code-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            align-items: center; /* Center the modal vertically */
            justify-content: center; /* Center the modal horizontally */
        }
        #qr-code-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%; /* Full width on mobile */
            max-width: 300px; /* Max width */
            text-align: center;
        }
        #qr-code-img {
            width: 200px;
            height: 200px;
        }
        .btn-qr-option {
            width: 100%;
            margin-bottom: 10px;
        }
      #copy-promptpay {
          margin-left: 10px;
          padding: 2px 8px;
          font-size: 0.8em;
      }

      #copy-feedback {
          font-size: 0.9em;
          margin-top: 5px;
      }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="https://wd-information.glitch.me/gamethai2.html">
                <img src="https://raw.githubusercontent.com/infobwd/wdconnect/main/%E0%B8%AA%E0%B8%9E%E0%B8%90%203D%20%E0%B8%82%E0%B8%AD%E0%B8%9A.png" alt="Logo">
                ‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡∏±‡∏á‡∏î‡πâ‡∏á
            </a>
              <div class="d-flex align-items-center">
                <button class="btn btn-outline-light navbar-button" id="toggleNavbar" data-bs-toggle="tooltip" title="Toggle Navbar">
                    <i class="bi bi-eye"></i>
                </button>
                <button class="btn btn-outline-light navbar-button" id="fullscreenButton" data-bs-toggle="tooltip" title="Fullscreen">
                    <i class="bi bi-fullscreen"></i>
                </button>
                <button class="btn btn-outline-light navbar-button" id="shareFacebook" data-bs-toggle="tooltip" title="Share on Facebook">
                    <i class="bi bi-facebook"></i>
                </button>
                <button class="btn btn-outline-light navbar-button" id="shareLine" data-bs-toggle="tooltip" title="Share on Line">
                    <i class="bi bi-line"></i>
                </button>
               <button id="liffLoginButton" class="btn btn-outline-light navbar-button me-2" style="display: none;">
                    <i class="bi bi-line"></i> Line Login
               </button>
               <button id="liffLogoutButton" class="btn btn-outline-light navbar-button me-2" style="display: none;">
                  <i class="bi bi-box-arrow-right"></i> Logout
               </button>
              <img id="lineProfileImage" src="" alt="Line Profile" style="width: 30px; height: 30px; border-radius: 50%; display: none;">
            </div>
        </div>
    </nav>
    <div id="showNavbarTab" onclick="showNavbar()">
        <i class="bi bi-list"></i>
    </div>

    <div class="container">
        <h1 class="text-center title-spacing">‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥</h1>
        <div id="setup">
            <div class="team-setup">
                <div class="team-input">
                    <input type="text" id="team1-name-input" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏° 1">
                  <select id="team1-icon-select" class="form-select mt-2">
                      <option value="" selected disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå</option>
                      <option value="üê∂">üê∂ ‡∏ô‡πâ‡∏≠‡∏á‡∏´‡∏°‡∏≤</option>
                      <option value="üê±">üê± ‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏°‡∏ß</option>
                      <option value="üê≠">üê≠ ‡∏ô‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏π</option>
                      <option value="üê∞">üê∞ ‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢</option>
                      <option value="üêº">üêº ‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤</option>
                      <option value="ü¶ä">ü¶ä ‡∏ô‡πâ‡∏≠‡∏á‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å</option>
                      <option value="ü¶Å">ü¶Å ‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏¥‡∏á‡πÇ‡∏ï</option>
                      <option value="üê∏">üê∏ ‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡∏ö</option>
                      <option value="üêß">üêß ‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏ô‡∏Å‡∏ß‡∏¥‡∏ô</option>
                      <option value="ü¶â">ü¶â ‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡∏Å‡∏Æ‡∏π‡∏Å</option>
                  </select>
                </div>
                <div class="team-input">
                    <input type="text" id="team2-name-input" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏° 2">
                    <select id="team2-icon-select" class="form-select mt-2">
                      <option value="" selected disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå</option>
                      <option value="üê±">üê± ‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏°‡∏ß</option>
                      <option value="üê∂">üê∂ ‡∏ô‡πâ‡∏≠‡∏á‡∏´‡∏°‡∏≤</option>
                      <option value="üê≠">üê≠ ‡∏ô‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏π</option>
                      <option value="üê∞">üê∞ ‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢</option>
                      <option value="üêº">üêº ‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤</option>
                      <option value="ü¶ä">ü¶ä ‡∏ô‡πâ‡∏≠‡∏á‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å</option>
                      <option value="ü¶Å">ü¶Å ‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏¥‡∏á‡πÇ‡∏ï</option>
                      <option value="üê∏">üê∏ ‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡∏ö</option>
                      <option value="üêß">üêß ‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏ô‡∏Å‡∏ß‡∏¥‡∏ô</option>
                      <option value="ü¶â">ü¶â ‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡∏Å‡∏Æ‡∏π‡∏Å</option>
                    </select>
                </div>
            </div>
            <select id="countdown-select" class="form-select mb-3">
                <option value="10">10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="20">20 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="30">30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="40">40 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="50">50 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
                <option value="60">60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</option>
            </select>
            <select id="word-set-select" class="form-select mb-3" required>
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥</option>
            </select>
            <button id="start-game" class="btn btn-primary w-100" data-bs-toggle="tooltip" title="Start Game">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
        </div>
        <div id="game">
            <div id="word-set-title" class="text-center mb-3"></div>
            <div class="team-info">
                <div class="team-display" id="team1-display">
                    <div class="crown-icon">üëë</div>
                    <div class="team-icon" id="team1-icon"></div>
                    <div class="team-name" id="team1-name"></div>
                    <div class="score-buttons">
                        <button class="btn btn-danger score-button subtract" onclick="updateScore(1, -1)">-</button>
                        <span class="mx-2" id="team1-score">0</span>
                        <button class="btn btn-success score-button add" onclick="updateScore(1, 1)">+</button>
                    </div>
                </div>
                <div class="team-display" id="team2-display">
                    <div class="crown-icon">üëë</div>
                    <div class="team-icon" id="team2-icon"></div>
                    <div class="team-name" id="team2-name"></div>
                    <div class="score-buttons">
                        <button class="btn btn-danger score-button subtract" onclick="updateScore(2, -1)">-</button>
                        <span class="mx-2" id="team2-score">0</span>
                        <button class="btn btn-success score-button add" onclick="updateScore(2, 1)">+</button>
                    </div>
                </div>
            </div>
            <div id="puzzle"></div>
            <audio id="countdown-audio" src="https://raw.githubusercontent.com/infobwd/wdconnect/main/clock-ticking-60-second-countdown-118231.mp3"></audio>
            <div class="button-group mt-3">
                <button id="reveal-button" class="btn btn-warning" data-bs-toggle="tooltip" title="Reveal Answer"><i class="bi bi-eye-fill"></i> ‡πÄ‡∏â‡∏•‡∏¢</button>
                <button id="hint-button" class="btn btn-info" data-bs-toggle="tooltip" title="Use Hint"><i class="bi bi-lightbulb-fill"></i> ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</button>
                <button id="next-word-button" class="btn btn-primary" data-bs-toggle="tooltip" title="Next Word"><i class="bi bi-arrow-right"></i> ‡∏Ñ‡∏≥‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
                              <button id="generate-pdf-button" class="btn btn-secondary" onclick="generateHandwritingPDF()"><i class="bi bi-file-earmark-pdf"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å
                </button>
                <button id="restart-game-button" class="btn btn-secondary" data-bs-toggle="tooltip" title="Restart Game"><i class="bi bi-arrow-repeat"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà</button>

            </div>
        </div>
        <div id="solution-modal">
            <p id="solution-text"></p>
        </div>
        <div id="countdown-modal">
            <div class="team-info">
                <div class="team-display">
                    <div class="team-icon" id="countdown-team-icon"></div>
                    <div class="team-name" id="countdown-team-name"></div>
                </div>
            </div>
            <p id="countdown-text"></p>
        </div>
    </div>

    <div id="qr-code-modal">
        <div id="qr-code-content">
            <h2>‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Å‡∏≤‡πÅ‡∏ü‡∏ô‡∏û‡∏£‡∏∏‡∏à</h2>
            <img id="qr-code-img" src="" alt="QR Code">
            <p>Scan QRcode ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå: 
                <span id="promptpay-number-display">0836645989</span>
                <button id="copy-promptpay" class="btn btn-secondary btn-sm ml-2">
                    <i class="bi bi-clipboard"></i> Copy
                </button>
            </p>
            <div id="copy-feedback" class="text-success" style="display: none;">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</div>
            <button class="btn btn-danger mt-3" onclick="closeQRCodeModal()">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <footer>
        <span>&copy; 2024 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡∏±‡∏á‡∏î‡πâ‡∏á</span>
        <div>
            <button class="support-button" onclick="showSupportMessage()">
                <i class="bi bi-cup"></i> ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡πÄ‡∏£‡∏≤
            </button>
            <button class="contact-button" id="contactButton">
                <i class="bi bi-envelope"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤
            </button>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const setupDiv = document.getElementById('setup');
        const gameDiv = document.getElementById('game');
        const puzzleDiv = document.getElementById('puzzle');
        const revealButton = document.getElementById('reveal-button');
        const nextWordButton = document.getElementById('next-word-button');
        const restartGameButton = document.getElementById('restart-game-button');
        const solutionModal = document.getElementById('solution-modal');
        const solutionText = document.getElementById('solution-text');
        const startGameButton = document.getElementById('start-game');
        const wordSetSelect = document.getElementById('word-set-select');
        const wordSetTitle = document.getElementById('word-set-title');
        const countdownModal = document.getElementById('countdown-modal');
        const countdownText = document.getElementById('countdown-text');
        const hintButton = document.getElementById('hint-button');
        const shareButton = document.getElementById('shareFacebook');
        const lineButton = document.getElementById('shareLine');
        const toggleNavbarButton = document.getElementById('toggleNavbar');
        const showNavbarTab = document.getElementById('showNavbarTab');

        let timeLeft;
        let countdownInterval;
        let currentWord;
        let currentImage;
        let currentRedLetter;
        let wordSets = [];
        let currentWordSet = [];
        let currentWordIndex = 0;
        let teamScores = [0, 0];
        let hintUsed = false;
        let currentOpeningTeam = 1;

        const teamIcons = {
            'üê∂': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡∏´‡∏°‡∏≤',
            'üê±': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏°‡∏ß',
            'üê≠': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡∏´‡∏ô‡∏π',
            'üê∞': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢',
            'üêº': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤',
            'ü¶ä': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å',
            'ü¶Å': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏¥‡∏á‡πÇ‡∏ï',
            'üê∏': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡∏Å‡∏ö',
            'üêß': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏ô‡∏Å‡∏ß‡∏¥‡∏ô',
            'ü¶â': '‡∏ó‡∏µ‡∏°‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡∏Å‡∏Æ‡∏π‡∏Å'
        };
        let usedNames = [];

        function getRandomTeamIcon() {
            const icons = Object.keys(teamIcons);
            return icons[Math.floor(Math.random() * icons.length)];
        }
        
        function getTeamNameFromIcon(icon) {
            return teamIcons[icon] || '‡∏ó‡∏µ‡∏°‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
        }
        
        function getRandomThaiName() {
            const icon = getRandomTeamIcon();
            return getTeamNameFromIcon(icon);
        }

        function displayError(message) {
            Swal.fire({
                icon: 'error',
                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                text: message,
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
        }

        async function fetchWordSets() {
            try {
                const response = await fetch('https://opensheet.elk.sh/1YVZV9IN3K1bIXO0am28DHXONnQWFVs-gguHyYgsuXHQ/‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                wordSets = await response.json();
                if (!Array.isArray(wordSets) || wordSets.length === 0) {
                    throw new Error('Invalid data received for word sets');
                }
                wordSets.forEach(set => {
                    if (set && set['ID ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'] && set['‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥']) {
                        const option = document.createElement('option');
                        option.value = set['ID ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'];
                        option.textContent = set['‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'];
                        wordSetSelect.appendChild(option);
                    }
                });
                if (wordSetSelect.options.length <= 1) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                }
            } catch (error) {
                console.error('Error fetching word sets:', error);
                displayError(error.message);
            }
        }

  async function fetchWords(wordSetId) {
    try {
        const response = await fetch(`https://opensheet.elk.sh/1YVZV9IN3K1bIXO0am28DHXONnQWFVs-gguHyYgsuXHQ/‡∏Ñ‡∏≥`);
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        const data = await response.json();
        if (!Array.isArray(data)) {
            throw new Error('Invalid data received for words');
        }
        return data.filter(word => word && word['ID ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'] === wordSetId);
    } catch (error) {
        console.error('Error fetching words:', error);
        return [];
    }
}

        function startCountdown() {
            clearInterval(countdownInterval);
            const countdownSelect = document.getElementById('countdown-select');
            if (countdownSelect) {
                timeLeft = parseInt(countdownSelect.value) || 30;
            } else {
                timeLeft = 30;
            }
            updateCountdownDisplay();
            countdownModal.style.display = 'flex';
            
            // Play countdown audio
            const countdownAudio = document.getElementById('countdown-audio');
            if (countdownAudio) {
                countdownAudio.play();
            }

            countdownInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateCountdownDisplay();
                } else {
                    clearInterval(countdownInterval);
                    countdownModal.style.display = 'none';
                    if (countdownAudio) {
                        countdownAudio.pause();
                        countdownAudio.currentTime = 0;
                    }
                    countdownText.innerHTML = `${timeLeft} ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤`;
                    switchTeam();
                }
            }, 1000);
        }

        function updateCountdownDisplay() {
            if (countdownText) {
                const pastelColors = ['#FFB3BA', '#FFDFBA', '#FFFFBA', '#BAFFC9', '#BAE1FF', '#FFB3FF', '#B3E5FF', '#D4BAFF', '#FFCBA4'];
                const randomColor = pastelColors[Math.floor(Math.random() * pastelColors.length)];
                countdownText.style.color = randomColor;
                countdownText.textContent = `${timeLeft}`;
            }
        }


function revealSolution() {
    if (solutionText && currentWord) {
        let coloredWord = '';
        if (currentRedLetter) {
            // ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏ß‡∏Å
            coloredWord = currentWord.replace(currentRedLetter, `<span style="color: red;">${currentRedLetter}</span>`);
        } else {
            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏ß‡∏Å
            const thaiConsonants = '‡∏Å‡∏Ç‡∏É‡∏Ñ‡∏Ö‡∏Ü‡∏á‡∏à‡∏â‡∏ä‡∏ã‡∏å‡∏ç‡∏é‡∏è‡∏ê‡∏ë‡∏í‡∏ì‡∏î‡∏ï‡∏ñ‡∏ó‡∏ò‡∏ô‡∏ö‡∏õ‡∏ú‡∏ù‡∏û‡∏ü‡∏†‡∏°‡∏¢‡∏£‡∏•‡∏ß‡∏®‡∏©‡∏™‡∏´‡∏¨‡∏≠‡∏Æ';
            const thaiVowels = '‡∏∞‡∏±‡∏≤‡∏≥‡∏¥‡∏µ‡∏∂‡∏∑‡∏∏‡∏π‡πÄ‡πÅ‡πÇ‡πÉ‡πÑ‡πá‡πå';
            const thaiToneMarks = '‡πà‡πâ‡πä‡πã';

            coloredWord = currentWord.split('').map(char => {
                if (thaiConsonants.includes(char)) {
                    return `<span style="color: white;">${char}</span>`;
                } else if (thaiVowels.includes(char)) {
                    return `<span style="color: red;">${char}</span>`;
                } else if (thaiToneMarks.includes(char)) {
                    return `<span style="color: green;">${char}</span>`;
                } else {
                    return `<span style="color: blue;">${char}</span>`; // ‡∏ï‡∏±‡∏ß‡∏™‡∏∞‡∏Å‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                }
            }).join('');
        }
        
        solutionText.innerHTML = coloredWord;
        if (solutionModal) solutionModal.style.display = 'flex';
        if (nextWordButton) nextWordButton.style.display = 'inline-block';
        if (revealButton) revealButton.style.display = 'none';
        
        document.querySelectorAll('.piece').forEach(piece => {
            piece.style.backgroundImage = `url(${currentImage})`;
            piece.style.backgroundPosition = `${-100 * (piece.dataset.index % 3)}% ${-100 * Math.floor(piece.dataset.index / 3)}%`;
            piece.classList.add('revealed');
        });
    }
}

        function resetPuzzle() {
            if (puzzleDiv) puzzleDiv.innerHTML = '';
            if (revealButton) revealButton.style.display = 'inline-block';
            if (nextWordButton) nextWordButton.style.display = 'none';
            clearInterval(countdownInterval);
            if (countdownModal) countdownModal.style.display = 'none';
        }

        function getGameResult() {
            const team1Score = teamScores[0];
            const team2Score = teamScores[1];
            const team1Name = document.getElementById('team1-name').textContent;
            const team2Name = document.getElementById('team2-name').textContent;

            let resultText = `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô:\n${team1Name}: ${team1Score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô\n${team2Name}: ${team2Score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô\n\n`;

            if (team1Score > team2Score) {
                resultText += `‡∏ó‡∏µ‡∏°‡∏ä‡∏ô‡∏∞: ${team1Name}`;
            } else if (team2Score > team1Score) {
                resultText += `‡∏ó‡∏µ‡∏°‡∏ä‡∏ô‡∏∞: ${team2Name}`;
            } else {
                resultText += "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô: ‡πÄ‡∏™‡∏°‡∏≠";
            }

            return resultText;
        }

        function highlightActiveTeam() {
            const team1Display = document.getElementById('team1-display');
            const team2Display = document.getElementById('team2-display');

            team1Display.classList.toggle('active-team', currentOpeningTeam === 1);
            team2Display.classList.toggle('active-team', currentOpeningTeam === 2);

            const team1Score = parseInt(document.getElementById('team1-score').textContent);
            const team2Score = parseInt(document.getElementById('team2-score').textContent);

            team1Display.classList.toggle('leading-team', team1Score > team2Score);
            team2Display.classList.toggle('leading-team', team2Score > team1Score);
        }

        function createPuzzle() {
            resetPuzzle();
            
            if (currentWordIndex >= currentWordSet.length) {
                endGame();
                return;
            }

            const word = currentWordSet[currentWordIndex];
            currentWord = word['‡∏Ñ‡∏≥'];
            currentImage = word['‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'];
            currentRedLetter = word['‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏ß‡∏Å'];

            for (let i = 0; i < 9; i++) {
                const piece = document.createElement('div');
                piece.className = 'piece';
                piece.dataset.index = i;
                piece.textContent = i + 1;
                piece.addEventListener('click', () => {
                    if (!piece.classList.contains('revealed')) {
                        piece.style.backgroundImage = `url(${currentImage})`;
                        piece.style.backgroundPosition = `${-100 * (i % 3)}% ${-100 * Math.floor(i / 3)}%`;
                        piece.classList.add('revealed');
                        startCountdown();
                    }
                });
                if (puzzleDiv) puzzleDiv.appendChild(piece);
            }

            if (wordSetTitle) {
                wordSetTitle.innerHTML = `‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥ : ${wordSets.find(set => set['ID ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'] === word['ID ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'])['‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥']} <br> (‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà ${currentWordIndex + 1} ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${currentWordSet.length} ‡∏Ñ‡∏≥)`;
            }

            if (nextWordButton) {
                if (currentWordIndex === currentWordSet.length - 1) {
                    nextWordButton.textContent = '‡∏à‡∏ö‡πÄ‡∏Å‡∏°';
                    nextWordButton.onclick = endGame;
                } else {
                    nextWordButton.textContent = '‡∏Ñ‡∏≥‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
                    nextWordButton.onclick = () => {
                        currentWordIndex++;
                        nextWord();
                    };
                }
            }

            highlightActiveTeam();
        }

        function updateScore(team, change) {
            try {
                teamScores[team - 1] += change;
                const scoreElement = document.getElementById(`team${team}-score`);
                if (scoreElement) {
                    scoreElement.textContent = teamScores[team - 1];
                } else {
                    console.error(`Score element for team ${team} not found`);
                }
                highlightActiveTeam();
            } catch (error) {
                console.error('Error updating score:', error);
            }
        }


      async function startGame() {
    try {
        const team1NameInput = document.getElementById('team1-name-input');
        const team2NameInput = document.getElementById('team2-name-input');
        const team1IconSelect = document.getElementById('team1-icon-select');
        const team2IconSelect = document.getElementById('team2-icon-select');

        // ‡∏™‡∏∏‡πà‡∏° icon ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        const team1Icon = team1IconSelect && team1IconSelect.value ? team1IconSelect.value : getRandomTeamIcon();
        const team2Icon = team2IconSelect && team2IconSelect.value ? team2IconSelect.value : getRandomTeamIcon();

        const team1Name = team1NameInput && team1NameInput.value ? team1NameInput.value : getTeamNameFromIcon(team1Icon);
        const team2Name = team2NameInput && team2NameInput.value ? team2NameInput.value : getTeamNameFromIcon(team2Icon);

        if (!wordSetSelect) {
            throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
        }

        const selectedWordSetId = wordSetSelect.value;
        if (!selectedWordSetId) {
            Swal.fire({
                icon: 'warning',
                title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥',
                text: '‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°',
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
            return;
        }

        currentWordSet = await fetchWords(selectedWordSetId);
        if (!currentWordSet || currentWordSet.length === 0) {
            throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
        }

        // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥
        currentWordSet = shuffleArray(currentWordSet);

        currentWordIndex = 0;
        teamScores = [0, 0];
        hintUsed = false;

        if (setupDiv) setupDiv.style.display = 'none';
        if (gameDiv) gameDiv.style.display = 'block';

        document.getElementById('team1-icon').textContent = team1Icon;
        document.getElementById('team1-name').textContent = team1Name;
        document.getElementById('team2-icon').textContent = team2Icon;
        document.getElementById('team2-name').textContent = team2Name;
        // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á PDF
        document.getElementById('generate-pdf-button').style.display = 'inline-block';
        document.getElementById('team1-score').textContent = '0';
        document.getElementById('team2-score').textContent = '0';

        currentOpeningTeam = Math.random() < 0.5 ? 1 : 2;
        
        highlightActiveTeam();

        Swal.fire({
            title: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°',
            html: `‡∏ó‡∏µ‡∏° ${currentOpeningTeam} (${document.getElementById(`team${currentOpeningTeam}-name`).textContent}) ‡πÄ‡∏õ‡πá‡∏ô‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏•‡πà‡∏ô‡∏Å‡πà‡∏≠‡∏ô`,
            icon: 'info',
            timer: 3000,
            timerProgressBar: true,
            showConfirmButton: false
        });

        createPuzzle();
    } catch (error) {
        console.error('Error starting game:', error);
        displayError(error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    }
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á array
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

        function nextWord() {
            hintUsed = false;
            if (solutionModal) solutionModal.style.display = 'none';
            
            currentOpeningTeam = Math.random() < 0.5 ? 1 : 2;
            
            highlightActiveTeam();

            Swal.fire({
                title: '‡∏ó‡∏µ‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ',
                html: `‡∏ó‡∏µ‡∏° ${currentOpeningTeam} (${document.getElementById(`team${currentOpeningTeam}-name`).textContent}) ‡πÄ‡∏õ‡πá‡∏ô‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏•‡πà‡∏ô`,
                icon: 'info',
                timer: 3000,
                timerProgressBar: true,
                showConfirmButton: false
            });

            createPuzzle();
        }

        function endGame() {
            const gameResult = getGameResult();
            Swal.fire({
                icon: 'info',
                title: '‡∏à‡∏ö‡πÄ‡∏Å‡∏°',
                html: gameResult.replace(/\n/g, '<br>'),
                confirmButtonText: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà'
            }).then((result) => {
                if (result.isConfirmed) {
                    resetGame();
                }
            });
        }

        function resetGame() {
            resetPuzzle();
            if (solutionModal) solutionModal.style.display = 'none';
            if (setupDiv) setupDiv.style.display = 'block';
            if (gameDiv) gameDiv.style.display = 'none';
            currentWordIndex = 0;
            currentWordSet = [];
            teamScores = [0, 0];
             // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á PDF
            document.getElementById('generate-pdf-button').style.display = 'none';
        }

        function restartGame() {
            resetGame();
            Swal.fire({
                title: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà?',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '‡πÉ‡∏ä‡πà',
                cancelButtonText: '‡πÑ‡∏°‡πà'
            }).then((result) => {
                if (result.isConfirmed) {
                    setupDiv.style.display = 'block';
                    gameDiv.style.display = 'none';
                }
            });
        }

      function showHint() {
    if (currentWord && !hintUsed) {
        Swal.fire({
            title: '‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ',
            html: '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏≥<br>‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 1 ‡πÅ‡∏ï‡πâ‡∏°',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: '‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        }).then((result) => {
            if (result.isConfirmed) {
                let thaiHint = currentWord.split('').map(char => 
                    char === currentRedLetter || Math.random() < 0.3 ? char : '_'
                ).join('');
                
                let englishHint = currentWordSet[currentWordIndex]['‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©'] || 'No English hint available';

                Swal.fire({
                    title: '‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ',
                    html: `
                        <p>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢: ${thaiHint}</p>
                        <p>English Hint: ${englishHint}</p>
                        <button id="speak-hint" class="btn btn-primary">‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</button>
                    `,
                    icon: 'info',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    didOpen: () => {
                        document.getElementById('speak-hint').addEventListener('click', () => {
                            speakEnglishHint(englishHint);
                        });
                    }
                });
                hintUsed = true;
                updateScore(currentOpeningTeam, -1);
            }
        });
    }
}

function speakEnglishHint(text) {
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 0.8; // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î (0.1 ‡∏ñ‡∏∂‡∏á 10)
        speechSynthesis.speak(utterance);
    } else {
        console.log('Text-to-speech not supported.');
        alert('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
    }
}

        function showSupportMessage() {
            Swal.fire({
                title: '‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡πÄ‡∏£‡∏≤',
                html: `<img src="https://raw.githubusercontent.com/infobwd/STUDENT-CARE/main/ImageOnly.jpg" alt="Support" style="width: 100%; height: auto; margin-bottom: 10px;">
                       <p>‡∏•‡∏î‡∏†‡∏≤‡∏©‡∏µ‡πÑ‡∏î‡πâ 2 ‡πÄ‡∏ó‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô <br>‡∏ñ‡πâ‡∏≤ ‚ù§Ô∏è ‡∏î‡∏µ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Å‡∏≤‡πÅ‡∏ü ‡∏ô‡∏û‡∏£‡∏∏‡∏à ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå 
                       <span id="promptpay-number" onclick="showQRCode()">0836645989</span></p>`,
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
        }

        function showQRCode() {
            Swal.close(); // Close the support modal

            Swal.fire({
                title: '‚ù§Ô∏è ‡∏î‡∏µ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏Å‡∏≤‡πÅ‡∏ü ‡∏ô‡∏û‡∏£‡∏∏‡∏à',
                html: `<button onclick="generateQRCode(60)" class="btn btn-primary m-2 btn-qr-option">60 ‡∏ö‡∏≤‡∏ó</button>
                       <button onclick="generateQRCode(120)" class="btn btn-primary m-2 btn-qr-option">120 ‡∏ö‡∏≤‡∏ó</button>
                       <input type="number" id="custom-amount" class="form-control m-2 btn-qr-option" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏ö‡∏≤‡∏ó)">
                       <button onclick="generateQRCode(document.getElementById('custom-amount').value)" class="btn btn-primary m-2 btn-qr-option">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</button>`,
                showCancelButton: false,
                showConfirmButton: false
            });
        }

        function generateQRCode(amount) {
            if (!amount || amount <= 0) {
                Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }
            const promptpayNumber = '0836645989';
            const qrCodeUrl = `https://promptpay.io/${promptpayNumber}/${amount}.png`;
            document.getElementById('qr-code-img').src = qrCodeUrl;
            document.getElementById('promptpay-number-display').textContent = `${promptpayNumber} (${amount} ‡∏ö‡∏≤‡∏ó)`;
            document.getElementById('qr-code-modal').style.display = 'flex';
            Swal.close();
        }

        function closeQRCodeModal() {
            document.getElementById('qr-code-modal').style.display = 'none';
        }

        function shareToFacebook() {
            html2canvas(document.querySelector("#puzzle")).then(canvas => {
                const imageData = canvas.toDataURL("image/png");
                const url = encodeURIComponent(window.location.href);
                const imageUrl = encodeURIComponent(imageData);
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤!&picture=${imageUrl}`, '_blank');
            });
        }



async function shareToLine() {
    if (!liff.isLoggedIn()) {
        try {
            await liff.login();
        } catch (error) {
            console.error('LIFF login failed', error);
            Swal.fire({
                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö LINE ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                icon: 'error',
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
            return;
        }
    }

    let imageUrl, thaiHint, englishHint, wordSetName;

    if (currentWord && currentImage && currentWordSet && currentWordIndex !== undefined) {
        // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà
        imageUrl = currentImage;
        thaiHint = currentWord.split('').map(char => 
            char === currentRedLetter ? char : '_'
        ).join('');
        englishHint = currentWordSet[currentWordIndex]['‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©'];
        const currentWordSetId = currentWordSet[currentWordIndex]['ID ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'];
        wordSetName = wordSets.find(set => set['ID ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'] === currentWordSetId)['‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'];
    } else if (wordSets && wordSets.length > 0) {
        // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥
        const randomSetIndex = Math.floor(Math.random() * wordSets.length);
        const randomSet = wordSets[randomSetIndex];
        wordSetName = randomSet['‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥'];

        try {
            const wordsInSet = await fetchWords(randomSet['ID ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥']);
            
            if (wordsInSet && wordsInSet.length > 0) {
                const randomWordIndex = Math.floor(Math.random() * wordsInSet.length);
                const randomWord = wordsInSet[randomWordIndex];

                imageUrl = randomWord['‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'];
                thaiHint = randomWord['‡∏Ñ‡∏≥'].split('').map(char => 
                    char === randomWord['‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏ß‡∏Å'] ? char : '_'
                ).join('');
                englishHint = randomWord['‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©'];
            } else {
                throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
            }
        } catch (error) {
            console.error('Error processing words:', error);
            imageUrl = 'https://example.com/default-image.jpg';
            thaiHint = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ';
            englishHint = 'Start the game to see the hint';
        }
    } else {
        imageUrl = 'https://example.com/default-image.jpg';
        thaiHint = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ';
        englishHint = 'Start the game to see the hint';
        wordSetName = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥';
    }

    const flexMessage = {
        type: "flex",
        altText: "‡πÄ‡∏ä‡∏¥‡∏ç‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥!",
        contents: {
            type: "bubble",
            size: "giga",
            hero: {
                type: "image",
                url: imageUrl,
                size: "full",
                aspectRatio: "20:13",
                aspectMode: "cover"
            },
            body: {
                type: "box",
                layout: "vertical",
                contents: [
                    {
                        type: "text",
                        text: "‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏≥",
                        weight: "bold",
                        size: "xl"
                    },
                    {
                        type: "text",
                        text: `‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥: ${wordSetName}`,
                        margin: "md",
                        size: "sm",
                        color: "#aaaaaa"
                    },
                    {
                        type: "text",
                        text: `‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢: ${thaiHint}`,
                        margin: "md"
                    },
                    {
                        type: "text",
                        text: `English Hint: ${englishHint}`,
                        margin: "sm",
                        wrap: true
                    }
                ]
            },
            footer: {
                type: "box",
                layout: "vertical",
                contents: [
                    {
                        type: "button",
                        style: "primary",
                        action: {
                            type: "uri",
                            label: "‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°",
                            uri: "https://liff.line.me/2005494853-90APVvvQ"
                        }
                    },
                    {
                        type: "text",
                        text: "@WDSchool",
                        align: "center",
                        margin: "md",
                        size: "xs",
                        color: "#aaaaaa"
                    }
                ]
            }
        }
    };

    try {
        const result = await liff.shareTargetPicker([flexMessage]);
        if (result) {
            Swal.fire({
                title: '‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                text: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE ‡πÅ‡∏•‡πâ‡∏ß',
                icon: 'success',
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
        } else {
            console.log('TargetPicker was closed before sharing.');
            Swal.fire({
                title: '‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                text: '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå',
                icon: 'info',
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
        }
    } catch (error) {
        console.error('Error sharing message:', error);
        Swal.fire({
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
            icon: 'error',
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
        });
    }
}

      
      
       function addEventListeners() {
    if (revealButton) revealButton.addEventListener('click', revealSolution);
    if (nextWordButton) nextWordButton.addEventListener('click', nextWord);
    if (startGameButton) startGameButton.addEventListener('click', startGame);
    if (restartGameButton) restartGameButton.addEventListener('click', restartGame);
    if (hintButton) hintButton.addEventListener('click', showHint);
    
    document.addEventListener('click', (event) => {
        if (event.target === solutionModal) {
            solutionModal.style.display = 'none';
        }
        if (event.target === countdownModal) {
            countdownModal.style.display = 'none';
            clearInterval(countdownInterval);
            const countdownAudio = document.getElementById('countdown-audio');
            if (countdownAudio) {
                countdownAudio.pause();
                countdownAudio.currentTime = 0;
            }
            switchTeam();
        }
    });
    
    if (shareButton) shareButton.addEventListener('click', shareToFacebook);
    if (lineButton) lineButton.addEventListener('click', shareToLine);

    const contactButton = document.getElementById('contactButton');
    if (contactButton) {
        const contactTooltip = new bootstrap.Tooltip(contactButton);
        contactButton.addEventListener('click', () => {
            Swal.fire({
                title: '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤',
                html: '‡∏≠‡∏µ‡πÄ‡∏°‡∏•: example@school.com<br>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: 123-456-7890',
                icon: 'info',
                confirmButtonText: '‡∏õ‡∏¥‡∏î'
            });
        });

        contactButton.addEventListener('mouseenter', () => {
            contactTooltip.show();
            setTimeout(() => {
                contactTooltip.hide();
            }, 5000);
        });
    }

    const liffLoginButton = document.getElementById('liffLoginButton');
    const liffLogoutButton = document.getElementById('liffLogoutButton');
    
    if (liffLoginButton) {
        liffLoginButton.addEventListener('click', handleLogin);
    }
    if (liffLogoutButton) {
        liffLogoutButton.addEventListener('click', handleLogout);
    }

    const team1IconSelect = document.getElementById('team1-icon-select');
    const team2IconSelect = document.getElementById('team2-icon-select');
    const team1NameInput = document.getElementById('team1-name-input');
    const team2NameInput = document.getElementById('team2-name-input');

    if (team1IconSelect) {
        team1IconSelect.addEventListener('change', (e) => {
            if (!team1NameInput.value) {
                team1NameInput.value = getTeamNameFromIcon(e.target.value);
            }
        });
    }

    if (team2IconSelect) {
        team2IconSelect.addEventListener('change', (e) => {
            if (!team2NameInput.value) {
                team2NameInput.value = getTeamNameFromIcon(e.target.value);
            }
        });
    }
}

        function switchTeam() {
            currentOpeningTeam = currentOpeningTeam === 1 ? 2 : 1;
            highlightActiveTeam();
            Swal.fire({
                title: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏°',
                html: `‡∏ó‡∏µ‡∏° ${currentOpeningTeam} (${document.getElementById(`team${currentOpeningTeam}-name`).textContent}) ‡πÄ‡∏õ‡πá‡∏ô‡∏ù‡πà‡∏≤‡∏¢‡πÄ‡∏•‡πà‡∏ô`,
                icon: 'info',
                timer: 3000,
                timerProgressBar: true,
                showConfirmButton: false
            });
        }

        const navbar = document.querySelector('.navbar');

        toggleNavbarButton.addEventListener('click', () => {
            if (navbar.style.display === 'none') {
                navbar.style.display = 'flex';
                toggleNavbarButton.style.display = 'none';
                showNavbarTab.style.display = 'none';
            } else {
                navbar.style.display = 'none';
                toggleNavbarButton.style.display = 'none';
                showNavbarTab.style.display = 'block';
            }
        });

        showNavbarTab.addEventListener('click', () => {
            navbar.style.display = 'flex';
            showNavbarTab.style.display = 'none';
            toggleNavbarButton.style.display = 'flex';
        });

        const fullscreenButton = document.getElementById('fullscreenButton');
        fullscreenButton.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fullscreenButton.innerHTML = '<i class="bi bi-fullscreen-exit"></i>';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenButton.innerHTML = '<i class="bi bi-fullscreen"></i>';
                }
            }
        });

        window.onclick = function(event) {
            const modal = document.getElementById('qr-code-modal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            try {
                addEventListeners();
                fetchWordSets().catch(error => {
                    console.error('Error during initial load:', error);
                    displayError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö');
                });
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            } catch (error) {
                console.error('Error during initialization:', error);
            }
        });
      function initializeLiff() {
            liff.init({
                liffId: "2005494853-90APVvvQ"
            }).then(() => {
                if (liff.isLoggedIn()) {
                    updateUIForLoggedInUser();
                } else {
                    document.getElementById('liffLoginButton').style.display = 'block';
                }
            }).catch((err) => {
                console.error('LIFF Initialization failed', err);
            });
        }

function updateUIForLoggedInUser() {
  liff.getProfile().then((profile) => {
    document.getElementById('lineProfileImage').src = profile.pictureUrl;
    document.getElementById('lineProfileImage').style.display = 'block';
    document.getElementById('liffLoginButton').style.display = 'none';
    document.getElementById('liffLogoutButton').style.display = 'block';

    // Log user login
    logUserLogin(profile.userId, profile.displayName, profile.pictureUrl);

    // ‡πÅ‡∏™‡∏î‡∏á SweetAlert2 ‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
    if (!sessionStorage.getItem('welcomeMessageShown')) {
        Swal.fire({
          title: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!',
          html: `<img src="${profile.pictureUrl}" alt="Line Profile" style="width: 100px; height: 100px; border-radius: 50%; margin-bottom: 15px;"><br>‡∏Ñ‡∏∏‡∏ì ${profile.displayName}`,
          icon: 'success',
          confirmButtonText: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°'
        });
        sessionStorage.setItem('welcomeMessageShown', 'true');
    }
  }).catch((err) => {
    console.error('Error getting profile', err);
  });
}

      function handleLogin() {
          if (!liff.isLoggedIn()) {
              liff.login().then(() => {
                  updateUIForLoggedInUser();
              }).catch((err) => {
                  console.error('Login failed', err);
              });
          }
      }

      function handleLogout() {
          if (liff.isLoggedIn()) {
              liff.logout();
              document.getElementById('lineProfileImage').style.display = 'none';
              document.getElementById('liffLoginButton').style.display = 'block';
              document.getElementById('liffLogoutButton').style.display = 'none';

              // ‡πÅ‡∏™‡∏î‡∏á SweetAlert2 ‡πÄ‡∏°‡∏∑‡πà‡∏≠ logout ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
              Swal.fire({
                  title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                  text: '‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏û‡∏≤‡πÄ‡∏î‡πá‡∏Å ‡πÜ ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö',
                  icon: 'info',
                  confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
              });

              // ‡∏•‡∏ö welcomeMessageShown ‡∏à‡∏≤‡∏Å sessionStorage
              sessionStorage.removeItem('welcomeMessageShown');
          }
      }

      // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listeners
      document.getElementById('liffLoginButton').addEventListener('click', handleLogin);
      document.getElementById('liffLogoutButton').addEventListener('click', handleLogout);

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô initializeLiff ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
      document.addEventListener('DOMContentLoaded', initializeLiff);  
      
    ///copy ‡πÄ‡∏•‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå
      document.addEventListener('DOMContentLoaded', function() {
    const copyButton = document.getElementById('copy-promptpay');
    const copyFeedback = document.getElementById('copy-feedback');
    const promptpayNumber = "0836645989"; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏•‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ

    copyButton.addEventListener('click', function() {
        if (navigator.clipboard && window.isSecureContext) {
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö browser ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö navigator.clipboard ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô secure context
            navigator.clipboard.writeText(promptpayNumber).then(() => {
                showCopyFeedback();
            });
        } else {
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö browser ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö navigator.clipboard ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà secure context
            const textArea = document.createElement('textarea');
            textArea.value = promptpayNumber;
            textArea.style.position = 'fixed';  // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            textArea.style.left = '-9999px';  // ‡∏ã‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showCopyFeedback();
            } catch (err) {
                console.error('Unable to copy to clipboard', err);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á');
            }
            document.body.removeChild(textArea);
        }
    });

    function showCopyFeedback() {
        copyFeedback.style.display = 'block';
        setTimeout(() => {
            copyFeedback.style.display = 'none';
        }, 2000);
    }
});
      function logUserLogin(uid, profileName, profileImage) {
          const scriptUrl = 'https://script.google.com/macros/s/AKfycby78K_kXW1YhVKO4EQMUuXo8D78d2mQuT6fphBAsxmoL_T86WkhZdILmhHkgw-BD-ac/exec';

          fetch(scriptUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              uid: uid,
              profileName: profileName,
              profileImage: profileImage
            })
          })
          .then(response => console.log('User login logged successfully'))
          .catch(error => console.error('Error logging user login:', error));
        }
 
    function generateHandwritingPDF() {
    if (!currentWordSet || currentWordSet.length === 0) {
        Swal.fire({
            title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥',
            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏±‡∏î‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠',
            icon: 'warning',
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
        });
        return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    let yPosition = 20;
    let promises = [];

    currentWordSet.forEach((word, index) => {
        const tempDiv = document.createElement('div');
        tempDiv.style.position = 'absolute';
        tempDiv.style.left = '-9999px';
        tempDiv.style.fontFamily = "'Google Sans', sans-serif";
        tempDiv.style.fontSize = '32px'; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î
        tempDiv.style.fontWeight = '400';
        tempDiv.innerHTML = word['‡∏Ñ‡∏≥']; // ‡∏•‡∏ö‡πÄ‡∏•‡∏Ç‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏≠‡∏≠‡∏Å

        document.body.appendChild(tempDiv);

        promises.push(html2canvas(tempDiv, {
            scale: 2 // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á canvas
        }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            doc.addImage(imgData, 'PNG', 20, yPosition - 15, canvas.width / 8, canvas.height / 8);
            
            yPosition += 10;

            for (let i = 0; i < 3; i++) {
                doc.setLineDash([2, 2]);
                doc.line(20, yPosition, 190, yPosition);
                yPosition += 10;
            }

            yPosition += 10;

            if (yPosition > 250) {
                doc.addPage();
                yPosition = 20;
            }

            document.body.removeChild(tempDiv);
        }));
    });

    Promise.all(promises).then(() => {
        doc.save('handwriting_practice.pdf');
    });
}
  
    </script>
</body>
</html>
